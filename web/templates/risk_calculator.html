{% extends "base.html" %}

{% block content %}

<h1>Risk Calculator</h1>

<!-- Form for importing Excel file -->
<form id="excel-form" enctype="multipart/form-data">
    <input type="file" id="excel-file" name="excel_file" accept=".xlsx, .xls">
    <button type="submit">Import Excel</button>
</form>

<hr>

<!-- Display imported routes and incidents -->
<div id="imported-data">
    <!-- Routes and Incidents will be displayed here -->
</div>

<hr>

<!-- Form for adding new Booking Date -->
<form id="booking-date-form">
    <label for="booking-date">New Booking Date:</label>
    <input type="date" id="booking-date" name="booking_date">
    <button type="submit">Add Booking Date</button>
</form>

<hr>

<!-- Risk Calculator Form -->
<form id="risk-form">
    <label for="load-port">Load Port:</label>
    <select id="load-port" name="load_port">
        <option value="London">London</option>
        <option value="Tokyo">Tokyo</option>
    </select>
    <label for="discharge-port">Discharge Port:</label>
    <select id="discharge-port" name="discharge_port">
        <option value="New York">New York</option>
        <option value="San Francisco">San Francisco</option>
    </select>
    <button type="submit">Calculate Risk</button>
</form>

<hr>

<!-- Leaflet Map -->
<div id="map" style="height: 600px;"></div>

<script>
    // Mock routes for initial map rendering
    const mockRoutes = [
        {
            "route_id": 1,
            "coordinates": [[51.5, -0.1], [40.7, -74.0]]
        },
        {
            "route_id": 2,
            "coordinates": [[35.6, 139.7], [37.8, -122.4]]
        }
    ];

    // Function to render the Leaflet map with routes
    function renderMap(routes) {
        // Leaflet map initialization (replace with your preferred map setup)
        var map = L.map('map').setView([51.505, -0.09], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        // Loop through routes and add polylines to the map
        routes.forEach(route => {
            L.polyline(route.coordinates, { color: 'blue' }).addTo(map);
        });
    }

    // Initial map rendering
    renderMap(mockRoutes);

    // Event listener for Excel file import form submission
    document.getElementById('excel-form').addEventListener('submit', function (e) {
        e.preventDefault();
        var formData = new FormData();
        formData.append('excel_file', document.getElementById('excel-file').files[0]);

        fetch('/import_excel', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Display imported data in the UI (replace with your implementation)
            console.log('Imported data:', data);
        })
        .catch(error => console.error('Error importing Excel file:', error));
    });

    // Event listener for Booking Date form submission
    document.getElementById('booking-date-form').addEventListener('submit', function (e) {
        e.preventDefault();
        var bookingDate = document.getElementById('booking-date').value;

        // Implement logic to add booking date (replace with your implementation)
        console.log('New Booking Date:', bookingDate);
    });

    // Event listener for Risk Calculator form submission
    document.getElementById('risk-form').addEventListener('submit', function (e) {
        e.preventDefault();
        var loadPort = document.getElementById('load-port').value;
        var dischargePort = document.getElementById('discharge-port').value;

        // Implement logic to calculate risk (replace with your implementation)
        console.log('Load Port:', loadPort);
        console.log('Discharge Port:', dischargePort);
    });

</script>

{% endblock %}
